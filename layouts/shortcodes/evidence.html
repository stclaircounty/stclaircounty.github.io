{{/*
  Evidence Reference Shortcode - Link to evidence items and depositions

  Usage:
    {{< evidence "evidence-spoliation-analysis" >}}           - Simple link
    {{< evidence "evidence-spoliation-analysis" card=true >}} - Card style
    {{< evidence "mat-king-deposition" >}}                    - Also works for depositions

  Parameters:
    - First arg: Evidence or deposition slug (required)
    - card: Show as card with summary (optional)
*/}}

{{ $slug := .Get 0 }}
{{ $showCard := .Get "card" }}

{{/* Look up in evidence data first, then depositions */}}
{{ $item := index site.Data.evidence $slug }}
{{ $isDeposition := false }}
{{ $url := printf "/evidence/%s/" $slug }}

{{ if not $item }}
  {{/* Try depositions data */}}
  {{ $item = index site.Data.depositions $slug }}
  {{ if $item }}
    {{ $isDeposition = true }}
    {{ $url = printf "/depositions/%s/" $slug }}
  {{ end }}
{{ end }}

{{ if $item }}
  {{/* Determine type for styling */}}
  {{ $itemType := $item.evidence_type | default "document" }}
  {{ if $isDeposition }}{{ $itemType = "deposition" }}{{ end }}

  {{ if $showCard }}
  {{/* Card style with summary */}}
  <a href="{{ $url }}" class="block my-4 p-4 bg-white border border-slate-200 rounded-lg hover:border-amber-400 hover:shadow-md transition-all not-prose">
    <div class="flex items-start gap-3">
      <div class="p-2 rounded-lg flex-shrink-0
        {{ if eq $itemType "deposition" }}bg-amber-100
        {{ else if eq $itemType "document" }}bg-blue-100
        {{ else if eq $itemType "video" }}bg-purple-100
        {{ else if eq $itemType "photo" }}bg-green-100
        {{ else if eq $itemType "audio" }}bg-orange-100
        {{ else }}bg-slate-100{{ end }}">
        {{ if eq $itemType "deposition" }}
        <svg class="w-5 h-5 text-amber-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
        </svg>
        {{ else if eq $itemType "document" }}
        <svg class="w-5 h-5 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        {{ else if eq $itemType "video" }}
        <svg class="w-5 h-5 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
        </svg>
        {{ else if eq $itemType "photo" }}
        <svg class="w-5 h-5 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        {{ else }}
        <svg class="w-5 h-5 text-slate-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
        </svg>
        {{ end }}
      </div>
      <div class="flex-1 min-w-0">
        <h4 class="font-semibold text-navy truncate">{{ $item.title }}</h4>
        {{ with $item.summary | default $item.significance }}
        <p class="text-sm text-slate-600 mt-1 line-clamp-2">{{ . | plainify | truncate 120 }}</p>
        {{ end }}
        <div class="flex items-center gap-2 mt-2 text-xs text-slate-500">
          <span class="px-1.5 py-0.5 bg-slate-100 rounded">{{ $itemType | humanize }}</span>
          {{ with $item.source }}<span>{{ . }}</span>{{ end }}
          {{ if $isDeposition }}{{ with $item.deponent.name }}<span>{{ . }}</span>{{ end }}{{ end }}
        </div>
      </div>
      <svg class="w-5 h-5 text-slate-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </div>
  </a>
  {{ else }}
  {{/* Simple inline link */}}
  <a href="{{ $url }}" class="inline-flex items-center gap-1 text-amber-600 hover:text-amber-700 font-medium">
    {{ if $isDeposition }}
    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
    </svg>
    {{ else }}
    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
    </svg>
    {{ end }}
    {{ $item.title }}
  </a>
  {{ end }}
{{ else }}
  <span class="text-slate-500" title="Evidence not found">{{ $slug | humanize | title }}</span>
{{ end }}

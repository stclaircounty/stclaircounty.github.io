{{ define "main" }}
{{/* Pull evidence from data file */}}
{{ $evidenceData := site.Data.evidence }}
{{ $evidence := slice }}
{{ range $key, $item := $evidenceData }}
  {{ if not (hasPrefix $key "_") }}
    {{ $evidence = $evidence | append (merge $item (dict "key" $key)) }}
  {{ end }}
{{ end }}
{{ $evidence = sort $evidence "date" "desc" }}

{{/* Count by type */}}
{{ $analysis := 0 }}
{{ $document := 0 }}
{{ $index := 0 }}
{{ $other := 0 }}
{{ range $evidence }}
  {{ $type := .evidence_type | default "document" }}
  {{ if eq $type "analysis" }}{{ $analysis = add $analysis 1 }}
  {{ else if eq $type "document" }}{{ $document = add $document 1 }}
  {{ else if eq $type "index" }}{{ $index = add $index 1 }}
  {{ else }}{{ $other = add $other 1 }}{{ end }}
{{ end }}

{{ partial "list-header.html" (dict
  "page" .
  "icon" "folder"
  "title" "Evidence Archive"
  "description" "Documents, analysis, and records obtained through FOIA requests, legal discovery, and public records."
  "count" (len $evidence)
  "count_label" "Items"
) }}

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
  {{ with .Content }}
  <div class="prose prose-sm sm:prose-lg max-w-none mb-8">
    {{ . }}
  </div>
  {{ end }}

  {{ if $evidence }}

  {{/* Stats bar */}}
  {{ partial "case-file/stats-bar.html" (dict "stats" (slice
    (dict "value" (len $evidence) "label" "Total" "color" "blue")
    (dict "value" $analysis "label" "Analysis" "color" "purple")
    (dict "value" $document "label" "Documents" "color" "green")
    (dict "value" $index "label" "Indexes" "color" "gray")
  )) }}

  {{/* Filter Controls */}}
  <div class="flex flex-wrap gap-4 mb-8">
    <span class="text-sm font-medium text-slate self-center">Filter by type:</span>
    <div class="flex flex-wrap gap-2">
      <button class="badge bg-gray-100 text-slate hover:bg-gray-200 evidence-filter active" data-filter="all">All</button>
      <button class="badge bg-teal-100 text-teal-800 hover:bg-teal-200 evidence-filter" data-filter="analysis">Analysis</button>
      <button class="badge bg-green-100 text-green-800 hover:bg-green-200 evidence-filter" data-filter="document">Documents</button>
      <button class="badge bg-indigo-100 text-indigo-800 hover:bg-indigo-200 evidence-filter" data-filter="index">Indexes</button>
    </div>
  </div>

  {{/* Evidence Grid */}}
  <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
    {{ range $evidence }}
    {{ partial "evidence-item/card.html" (dict "key" .key "data" .) }}
    {{ end }}
  </div>

  {{ else }}
  <div class="text-center py-16">
    <svg class="h-16 w-16 text-gray-300 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
    </svg>
    <p class="text-slate-light text-lg">No evidence archived yet.</p>
  </div>
  {{ end }}
</div>
{{ end }}

{{ define "scripts" }}
<script>
document.querySelectorAll('.evidence-filter').forEach(btn => {
  btn.addEventListener('click', function() {
    // Update active state
    document.querySelectorAll('.evidence-filter').forEach(b => b.classList.remove('active', 'ring-2', 'ring-offset-2'));
    this.classList.add('active', 'ring-2', 'ring-offset-2');

    const filter = this.dataset.filter;
    document.querySelectorAll('[data-type]').forEach(item => {
      if (filter === 'all' || item.dataset.type === filter) {
        item.style.display = 'block';
      } else {
        item.style.display = 'none';
      }
    });
  });
});
</script>
{{ end }}

{{ define "main" }}
{{/* Get litigation key from URL */}}
{{ $key := .File.ContentBaseName }}
{{ $data := index site.Data.litigation $key }}

{{ if $data }}
{{/* Build badges for page header */}}
{{ $badges := slice }}
{{ with $data.case_number }}
  {{ $badges = $badges | append (dict "label" . "type" "primary") }}
{{ end }}
{{ if eq $data.status "active" }}
  {{ $badges = $badges | append (dict "label" "Active" "type" "warning") }}
{{ else if eq $data.status "settled" }}
  {{ $badges = $badges | append (dict "label" "Settled" "type" "neutral") }}
{{ else if eq $data.status "closed" }}
  {{ $badges = $badges | append (dict "label" "Closed" "type" "neutral") }}
{{ end }}

{{/* Parse date for header */}}
{{ $date := time "0001-01-01" }}
{{ with $data.filed_date }}
  {{ $date = time . }}
{{ end }}

<article>
  {{/* Header */}}
  {{ partial "page-header.html" (dict
    "page" .
    "icon" "scale"
    "section" "Litigation"
    "title" $data.title
    "badges" $badges
    "date" $date
  ) }}

  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    {{/* Litigation detail content */}}
    {{ partial "litigation/detail.html" (dict "key" $key "data" $data "content" .Content) }}
  </div>

  {{/* Navigation */}}
  {{ $litigationData := site.Data.litigation }}
  {{ $allCases := slice }}
  {{ range $k, $case := $litigationData }}
    {{ if not (hasPrefix $k "_") }}
      {{ $allCases = $allCases | append (merge $case (dict "key" $k)) }}
    {{ end }}
  {{ end }}
  {{ $allCases = sort $allCases "filed_date" "desc" }}

  {{ $currentIndex := -1 }}
  {{ range $i, $case := $allCases }}
    {{ if eq $case.key $key }}{{ $currentIndex = $i }}{{ end }}
  {{ end }}

  {{ if gt (len $allCases) 1 }}
  <nav class="bg-gray-50 border-t py-8">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between">
        {{ if and (ge $currentIndex 0) (lt (add $currentIndex 1) (len $allCases)) }}
        {{ $next := index $allCases (add $currentIndex 1) }}
        <a href="/litigation/{{ $next.key }}/" class="text-accent hover:underline">
          &larr; {{ $next.title | truncate 40 }}
        </a>
        {{ else }}
        <span></span>
        {{ end }}

        {{ if and (gt $currentIndex 0) }}
        {{ $prev := index $allCases (sub $currentIndex 1) }}
        <a href="/litigation/{{ $prev.key }}/" class="text-accent hover:underline">
          {{ $prev.title | truncate 40 }} &rarr;
        </a>
        {{ end }}
      </div>
    </div>
  </nav>
  {{ end }}
</article>

{{ else }}
{{/* Fallback for content files not in data */}}
<article>
  {{ partial "page-header.html" (dict "page" . "icon" "scale" "section" "Litigation") }}

  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="bg-white rounded-lg shadow-card p-8">
      <div class="prose prose-lg max-w-none">
        {{ .Content }}
      </div>
    </div>
  </div>
</article>
{{ end }}
{{ end }}

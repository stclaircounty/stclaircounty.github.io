# Cloudflare Workers configuration
# Uses Workers CI/CD Builds with GitHub integration
# Docs: https://developers.cloudflare.com/workers/ci-cd/builds/configuration/

name = "stclaircounty-net"
main = "src/index.ts"
compatibility_date = "2024-12-01"

# Observability
[observability]
enabled = false
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = false
persist = true
head_sampling_rate = 1

# Static assets (Hugo build output)
[assets]
directory = "./public"
binding = "ASSETS"

# D1 Database for everything (contacts, uploads, rate limiting)
# Create with: wrangler d1 create scc-db
[[d1_databases]]
binding = "DB"
database_name = "scc-db"
database_id = "8fbd0217-9f3f-4f50-85e3-4c1d28ce47df"

# R2 Bucket for encrypted whistleblower uploads
# Create with: wrangler r2 bucket create scc-uploads
[[r2_buckets]]
binding = "UPLOADS_BUCKET"
bucket_name = "scc-uploads"

# Email routing - receives emails and processes them
# Configure routes in Cloudflare Dashboard > Email Routing
[[email.routing.rules]]
action = "worker"
address = "tip@stclaircounty.net"

[[email.routing.rules]]
action = "worker"
address = "contact@stclaircounty.net"

[[email.routing.rules]]
action = "worker"
address = "media@stclaircounty.net"

[[email.routing.rules]]
action = "worker"
address = "corrections@stclaircounty.net"

[[email.routing.rules]]
action = "worker"
address = "evidence@stclaircounty.net"

[[email.routing.rules]]
action = "worker"
address = "document@stclaircounty.net"

[[email.routing.rules]]
action = "worker"
address = "general@stclaircounty.net"

# Environment variables
[vars]
SITE_NAME = "St. Clair Under Oath"
MAX_FILE_SIZE = "104857600"
HUGO_BASEURL = "https://stclaircounty.net"
ENABLE_LOGGING = "false"
# ADMIN_SECRET - set via `wrangler secret put ADMIN_SECRET`

# Production environment (main branch)
[env.production]
name = "stclaircounty-net"

# Staging environment (staging branch)
[env.staging]
name = "stclaircounty-net-staging"

# Preview environment (all other branches)
[env.preview]
name = "stclaircounty-net-preview"
